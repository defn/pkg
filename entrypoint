#!/usr/bin/env bash

set -exfu

# initialize /nix
if [[ -d /nix-install ]]; then
    if [[ ! test -d /nix/var/nix/profiles/per-user/ubuntu/profile/. ]]; then
        rsync -ia /nix-install/. /nix/.
    else
        rsync -ia /nix-install/store/. /nix/store/.
    fi
fi

# put every nix store into the path
set +f; for a in /nix/store/*/bin; do PATH="$PATH:$a"; done; set -e

# one of the nix stores has an executable "nix-entrypoint"
exec "nix-entrypoint" "$@"
